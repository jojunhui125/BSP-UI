# Yocto BSP Studio — 통합 요구사항 명세서 (Consolidated PRD/SRS)

> **문서 버전**: 3.0  
> **최종 수정일**: 2026-01-28  
> **기반 문서**: need.md, 01_policy_spec.md, 02_manifest_and_job_spec.md, 03_kernel_config_strategy.md  
> **주요 업데이트**: BSP 뷰어 기능 강화, GPIO/Device Tree 시각화, Include Chain 분석

---

## 목차

1. [Executive Summary](#1-executive-summary)
2. [비전 및 핵심 가치](#2-비전-및-핵심-가치)
3. [사용자 정의 및 페르소나](#3-사용자-정의-및-페르소나)
4. [시스템 아키텍처](#4-시스템-아키텍처)
5. [⭐ BSP 뷰어 시스템 (핵심 기능)](#5-bsp-뷰어-시스템-핵심-기능)
6. [통합 코드 에디터](#6-통합-코드-에디터)
7. [정책 시스템 (Policy Engine)](#7-정책-시스템-policy-engine)
8. [빌드 Job 및 Manifest 시스템](#8-빌드-job-및-manifest-시스템)
9. [커널 설정 전략 (Kernel Configuration Strategy)](#9-커널-설정-전략-kernel-configuration-strategy)
10. [기능 요구사항 (Functional Requirements)](#10-기능-요구사항-functional-requirements)
11. [비기능 요구사항 (Non-Functional Requirements)](#11-비기능-요구사항-non-functional-requirements)
12. [UI/UX 요구사항](#12-uiux-요구사항)
13. [가드레일 시스템 (Guardrails)](#13-가드레일-시스템-guardrails)
14. [구현 로드맵](#14-구현-로드맵)
15. [리스크 분석 및 완화 전략](#15-리스크-분석-및-완화-전략)
16. [수용 기준 (Acceptance Criteria)](#16-수용-기준-acceptance-criteria)
17. [용어집 (Glossary)](#17-용어집-glossary)

---

## 1. Executive Summary

### 1.1 프로젝트 정의

**Yocto BSP Studio**는 Yocto 기반 Linux BSP 개발을 **GUI 중심의 워크플로**로 전환하는 **Electron 데스크탑 애플리케이션**이다.

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         핵심 가치 제안 (Value Proposition)                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   [기존]  SSH → 명령어 숙련 → 파일 위치 암기 → 수동 검증               │
│                            ↓                                            │
│   [신규]  GUI 워크플로 → 가드레일 → 자동 검증 → 완전 재현성            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 핵심 목표

| 목표 | 설명 | 측정 지표 |
|------|------|-----------|
| **진입장벽 파괴** | 초보자가 30분 내 첫 빌드 성공 | 온보딩 시간 ≤ 30분 |
| **⭐ 복잡한 구조 시각화** | GPIO/Device Tree/Include Chain 한눈에 파악 | 정보 탐색 시간 80%↓ |
| **통합 개발 환경** | 편집→빌드→다운로드 모든 작업을 툴 내에서 완결 | 외부 도구 의존 0 |
| **실수 방지** | 시스템적 가드레일로 흔한 실수 차단 | 실수로 인한 실패율 50%↓ |
| **완전 재현성** | 모든 빌드의 who/when/what/why 기록 | manifest.json 100% 생성 |
| **정책 강제** | 팀 표준을 코드(policy.yaml)로 강제 | 정책 위반 자동 감지율 95%↑ |

### 1.3 범위 정의

#### In Scope (v1.0) ⭐ 핵심 기능
- 로컬 프로젝트 열기 및 인덱싱
- SSH/rsync 기반 서버 동기화
- 원격 빌드 트리거 및 로그 스트리밍
- 아티팩트 자동 수집 및 SD카드 이미지 다운로드
- **⭐ 통합 코드 에디터** (Eclipse 수준, 직접 코드 수정)
- **⭐ BSP 뷰어 시스템** (GPIO/핀 정보, Device Tree, Include Chain 시각화)
- **Policy Engine** (정책 기반 행동 제어)
- **Manifest System** (빌드 재현성 보장)
- **Kernel Config Strategy** (벤더 커널 안전 관리)

#### Out of Scope (v2.0+)
- 보드 플래싱 자동화 (USB/NFS/OTA)
- 시리얼 콘솔 통합
- 멀티 서버 빌드 팜
- 실시간 디버깅 (GDB 통합)

---

## 2. 비전 및 핵심 가치

### 2.1 비전 선언문

> **"BSP 개발의 진입장벽을 파괴한다."**
> 
> 초보자가 "이유를 몰라도" 안전하게 올바른 결과를 내도록 돕고,  
> 숙련자에겐 "속도와 재현성"을 제공한다.

### 2.2 핵심 가치 (Non-Negotiable)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  1. ⭐ BSP 구조 시각화   GPIO/핀/DeviceTree/Include Chain 복잡성 해소      │
│  2. ⭐ 통합 에디터       Eclipse 수준의 편집기, 외부 도구 불필요           │
│  3. 한눈에 보이기       레이어/레시피/설정/커널/아티팩트 구조적 시각화     │
│  4. 실수 방지           위험한 변경은 차단 또는 강력 경고 + 대안 제시      │
│  5. 재현성              모든 빌드가 manifest로 기록되어 재생성 가능        │
│  6. 초보자 가이드       용어/규칙/추천 흐름이 툴 안에서 완결               │
│  7. 서버는 빌드 전용    로컬 편집 → 서버 빌드 → 로컬 다운로드             │
│  8. 정책 강제           policy.yaml로 팀 표준을 시스템 규칙화              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 사용자 정의 및 페르소나

### 3.1 대상 사용자

| 페르소나 | 경험 수준 | 핵심 니즈 | 툴에서 기대하는 것 |
|----------|-----------|-----------|-------------------|
| **초보자** | Yocto/BitBake 경험 없음 | BSP "설계"하고 싶지만 명령어/파일구조 모름 | 가이드 따라 첫 빌드 성공 |
| **중급자** | 레시피/레이어/커널 설정 이해 | 반복 작업과 실수 줄이기 | 자동화된 워크플로 |
| **숙련자** | CI/재현성/규모 확장 중요시 | 규칙 기반 자동화·검증·기록 | 정책 강제 + 완전 재현성 |

### 3.2 사용자 여정 (User Journey)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          초보자 온보딩 플로우                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Step 1: "새 프로젝트" 클릭                                             │
│      │                                                                  │
│      ▼                                                                  │
│  Step 2: 서버 SSH 연결 설정 (키/포트)                                   │
│      │   └─ [가이드] SSH 키 생성 방법 안내                              │
│      ▼                                                                  │
│  Step 3: 로컬 BSP 소스 폴더 선택                                        │
│      │   └─ [자동] bblayers.conf, local.conf 탐지                       │
│      ▼                                                                  │
│  Step 4: 서버 워크스페이스 경로 지정                                    │
│      │   └─ [검증] 권한/디스크 여유/필수 커맨드 확인                    │
│      ▼                                                                  │
│  Step 5: "초기 진단 실행" 클릭                                          │
│      │   └─ [자동] 레이어/머신/커널 provider/이미지 타겟 감지           │
│      ▼                                                                  │
│  Step 6: "추천 빌드" 버튼 클릭                                          │
│      │   └─ [자동] 동기화 → 빌드 → 로그 스트리밍 → 아티팩트 다운로드   │
│      ▼                                                                  │
│  Step 7: 성공! 이미지 파일 로컬 저장 완료                               │
│          └─ [기록] manifest.json 자동 생성                              │
│                                                                         │
│  ⏱️ 목표: 30분 이내 완료                                                │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 시스템 아키텍처

### 4.1 전체 구성도

```
┌───────────────────────────────────────────────────────────────────────────┐
│                           Electron App (Local)                            │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐           │
│  │   UI Layer      │  │  Policy Engine  │  │  Sync Manager   │           │
│  │  (React/Vue)    │  │  (YAML Parser)  │  │  (rsync/SSH)    │           │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘           │
│           │                    │                    │                     │
│  ┌────────┴────────────────────┴────────────────────┴────────┐           │
│  │                     IPC Bridge (Main Process)              │           │
│  └────────┬───────────────────────────────────────────────────┘           │
│           │                                                               │
│  ┌────────┴────────┐  ┌─────────────────┐  ┌─────────────────┐           │
│  │  SSH Manager    │  │  Manifest DB    │  │  Index Engine   │           │
│  │  (ssh2/node)    │  │  (SQLite/JSON)  │  │  (BitBake Parser)│          │
│  └────────┬────────┘  └─────────────────┘  └─────────────────┘           │
│           │                                                               │
└───────────┼───────────────────────────────────────────────────────────────┘
            │
            │ SSH + rsync + SFTP/scp
            ▼
┌───────────────────────────────────────────────────────────────────────────┐
│                         Build Server (Remote Linux)                       │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  /workspaces/<project>/           ← 소스/레이어/빌드 스크립트            │
│  /build-cache/downloads/          ← DL_DIR (공유 캐시)                   │
│  /build-cache/sstate-cache/       ← SSTATE_DIR (공유 캐시)               │
│  /artifacts/<project>/<job-id>/   ← 빌드 결과 + manifest.json            │
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────────┐     │
│  │  Yocto Build Environment                                        │     │
│  │  • BitBake 실행                                                 │     │
│  │  • tmp/deploy/images/<machine>/ 아티팩트 생성                   │     │
│  │  • 로그 스트리밍 (stdout/stderr)                                │     │
│  └─────────────────────────────────────────────────────────────────┘     │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
```

### 4.2 통신 프로토콜

| 용도 | 프로토콜 | 라이브러리 | 비고 |
|------|----------|------------|------|
| 연결/명령 실행 | SSH | ssh2 (Node.js) | 키 기반 인증 권장 |
| 파일 동기화 | rsync over SSH | node-rsync / cwRsync(Win) | 증분 전송 |
| 파일 다운로드 | SFTP | ssh2-sftp-client | 대용량 아티팩트 |
| 로그 스트리밍 | SSH exec | ssh2 | 실시간 stdout/stderr |

### 4.3 데이터 흐름

```
┌──────────────────────────────────────────────────────────────────────────┐
│                           데이터 흐름 다이어그램                          │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [로컬 편집]                                                             │
│      │                                                                   │
│      ▼                                                                   │
│  ┌────────────────┐    ┌────────────────┐    ┌────────────────┐         │
│  │ Policy Check   │───▶│ rsync Sync     │───▶│ SSH Build Cmd  │         │
│  │ (deny/warn)    │    │ (증분 전송)    │    │ (bitbake)      │         │
│  └────────────────┘    └────────────────┘    └───────┬────────┘         │
│                                                      │                   │
│                              ┌────────────────────────┘                   │
│                              ▼                                            │
│  ┌────────────────┐    ┌────────────────┐    ┌────────────────┐         │
│  │ Local Download │◀───│ Artifact       │◀───│ Build Execute  │         │
│  │ (SFTP)         │    │ Collection     │    │ + Log Stream   │         │
│  └───────┬────────┘    └────────────────┘    └────────────────┘         │
│          │                                                               │
│          ▼                                                               │
│  ┌────────────────┐                                                      │
│  │ manifest.json  │   ← 빌드 메타데이터 영구 기록                        │
│  │ 생성/저장      │                                                      │
│  └────────────────┘                                                      │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 5. ⭐ BSP 뷰어 시스템 (핵심 기능)

> **"파일을 하나씩 열어보는 고통에서 해방"**
> 
> BSP 개발의 가장 큰 Pain Point는 복잡한 include chain과 분산된 하드웨어 정보입니다.
> 이 섹션은 **뷰어로서의 탁월한 기능**을 정의합니다.

### 5.1 핵심 Pain Point 분석

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                        BSP 개발자의 현실적 고충                               │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ❌ GPIO 핀 정보 찾기                                                        │
│     └─ "PA5가 어디에 정의되어 있지?"                                         │
│        → board.dts → include soc.dtsi → include pinctrl.h → ...             │
│        → 5개 이상의 파일을 넘나들며 추적                                     │
│                                                                              │
│  ❌ Device Tree include chain                                                │
│     └─ "이 노드가 어디서 오버라이드 되는거지?"                               │
│        → 최상위 DTS부터 base DTSI까지 역추적 필요                            │
│                                                                              │
│  ❌ 커널 헤더 파일 미로                                                      │
│     └─ "이 매크로의 실제 값이 뭐지?"                                         │
│        → #include → #include → #ifdef → ... 무한 루프                       │
│                                                                              │
│  ❌ Pin Mux 설정 파악                                                        │
│     └─ "UART2_TX가 실제로 어떤 핀에 매핑되어 있지?"                          │
│        → pinctrl 노드 → 드라이버 → 데이터시트 크로스 체크                    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 GPIO/핀 정보 뷰어

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                         GPIO Pin Viewer                                      │
├──────────────────────────────────────────────────────────────────────────────┤
│  🔍 검색: [UART2_TX          ] [GPIO Bank: ▼ All] [검색]                     │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │  📍 검색 결과: UART2_TX                                                 ││
│  │                                                                         ││
│  │  ┌─────────────────────────────────────────────────────────────────┐   ││
│  │  │  Physical Pin: PE10 (Ball: A15)                                 │   ││
│  │  │  Function: UART2 Transmit                                       │   ││
│  │  │  Direction: Output                                              │   ││
│  │  │  Pull: None                                                     │   ││
│  │  │  Drive Strength: 8mA                                            │   ││
│  │  └─────────────────────────────────────────────────────────────────┘   ││
│  │                                                                         ││
│  │  📂 정의 위치 (클릭하면 해당 파일로 이동)                               ││
│  │  ├─ arch/arm64/boot/dts/freescale/s32g274a.dtsi:156                    ││
│  │  │   └─ pinctrl_uart2: uart2grp { ... }                                ││
│  │  ├─ include/dt-bindings/pinctrl/s32-pinctrl.h:89                       ││
│  │  │   └─ #define S32_PINMUX(a,b) ...                                    ││
│  │  └─ board/custom-board.dts:45                                          ││
│  │      └─ &uart2 { pinctrl-0 = <&pinctrl_uart2>; }                       ││
│  │                                                                         ││
│  │  🔗 관련 노드                                                           ││
│  │  ├─ /soc/serial@401c8000 (uart2)                                       ││
│  │  └─ /soc/pinctrl@400dc000                                              ││
│  │                                                                         ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │  🗺️ GPIO Bank Overview                                                  ││
│  │                                                                         ││
│  │  Bank A    Bank B    Bank C    Bank D    Bank E                        ││
│  │  ┌──┐      ┌──┐      ┌──┐      ┌──┐      ┌──┐                          ││
│  │  │■■│      │■□│      │□□│      │■■│      │■□│ ← UART2_TX               ││
│  │  │■□│      │□■│      │■□│      │□■│      │□■│                          ││
│  │  │□□│      │■■│      │■■│      │■□│      │■■│                          ││
│  │  └──┘      └──┘      └──┘      └──┘      └──┘                          ││
│  │  ■ = 사용중    □ = 미사용                                               ││
│  │                                                                         ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 5.3 Device Tree 뷰어

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                      Device Tree Hierarchy Viewer                            │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  📁 Include Chain (상위 → 하위)                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │                                                                         ││
│  │  s32g274a-base.dtsi          (SoC 기본 정의)                            ││
│  │       │                                                                 ││
│  │       ▼                                                                 ││
│  │  s32g2.dtsi                  (S32G2 공통)                               ││
│  │       │                                                                 ││
│  │       ▼                                                                 ││
│  │  s32g274a-evb.dts            (EVB 보드)                                 ││
│  │       │                                                                 ││
│  │       ▼                                                                 ││
│  │  custom-board.dts      ◀──── 현재 편집 중                               ││
│  │                                                                         ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  📊 노드 트리 (실시간 병합 결과)                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │                                                                         ││
│  │  / (root)                                                               ││
│  │  ├─ chosen                                                              ││
│  │  ├─ memory@80000000                                                     ││
│  │  ├─ cpus                                                                ││
│  │  │   ├─ cpu@0                                                           ││
│  │  │   ├─ cpu@1                                                           ││
│  │  │   ├─ cpu@2                                                           ││
│  │  │   └─ cpu@3                                                           ││
│  │  └─ soc                                                                 ││
│  │      ├─ interrupt-controller@50800000                                   ││
│  │      ├─ pinctrl@400dc000         ◀── 클릭 시 상세 정보                  ││
│  │      │   ├─ 📄 정의: s32g274a-base.dtsi:234                             ││
│  │      │   ├─ 📝 오버라이드: custom-board.dts:67                          ││
│  │      │   └─ 🔧 최종값 보기                                              ││
│  │      ├─ serial@401c8000 (uart2)                                         ││
│  │      ├─ spi@401d4000                                                    ││
│  │      └─ i2c@401e4000                                                    ││
│  │                                                                         ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  🔍 노드 검색: [pinctrl     ] [검색]    📋 [DTS 소스로 이동] [컴파일된 DTB] │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 5.4 Include Chain 시각화

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                      Include Chain Analyzer                                  │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  📂 파일: drivers/gpio/gpio-s32.c                                            │
│  🔍 심볼: S32_GPIO_PINMUX                                                    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │                       Include Chain Graph                               ││
│  │                                                                         ││
│  │  gpio-s32.c                                                             ││
│  │      │                                                                  ││
│  │      ├── #include <linux/gpio/driver.h>                                 ││
│  │      │       │                                                          ││
│  │      │       └── #include <linux/gpio.h>                                ││
│  │      │               │                                                  ││
│  │      │               └── #include <asm/gpio.h>                          ││
│  │      │                                                                  ││
│  │      ├── #include <dt-bindings/pinctrl/s32-pinctrl.h>  ◀── 정의 발견!  ││
│  │      │       │                                                          ││
│  │      │       └── #define S32_GPIO_PINMUX(a,b) ((a) << 8 | (b))          ││
│  │      │                    ▲                                             ││
│  │      │                    │                                             ││
│  │      │              최종 정의 위치                                      ││
│  │      │              Line 89                                             ││
│  │      │                                                                  ││
│  │      └── #include "gpio-s32-core.h"                                     ││
│  │              │                                                          ││
│  │              └── (내부 헤더, S32_GPIO_PINMUX 사용)                       ││
│  │                                                                         ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  📋 S32_GPIO_PINMUX 사용 위치 (총 15곳)                                      │
│  ├─ gpio-s32.c:156        s32_gpio_set_direction()                          │
│  ├─ gpio-s32.c:203        s32_gpio_request()                                │
│  ├─ gpio-s32-core.h:45    inline function                                   │
│  └─ ... [모두 보기]                                                         │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 5.5 하드웨어 리소스 맵 뷰어

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                    Hardware Resource Map                                     │
├──────────────────────────────────────────────────────────────────────────────┤
│  MACHINE: s32g274a          Board: Custom-Board-Rev1                        │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────┐          │
│  │                    Memory Map (0x0 - 0xFFFFFFFF)               │          │
│  ├───────────────────────────────────────────────────────────────┤          │
│  │  0x00000000 ┌──────────────┐                                  │          │
│  │             │   BootROM    │ 64KB                             │          │
│  │  0x00010000 ├──────────────┤                                  │          │
│  │             │   Reserved   │                                  │          │
│  │  0x34000000 ├──────────────┤                                  │          │
│  │             │    SRAM      │ 8MB                              │          │
│  │  0x40000000 ├──────────────┤                                  │          │
│  │             │ Peripherals  │ ◀── 클릭하면 상세 맵             │          │
│  │             │ ├─ UART0-3   │                                  │          │
│  │             │ ├─ SPI0-5    │                                  │          │
│  │             │ ├─ I2C0-4    │                                  │          │
│  │             │ ├─ GPIO      │                                  │          │
│  │             │ └─ ...       │                                  │          │
│  │  0x80000000 ├──────────────┤                                  │          │
│  │             │    DRAM      │ 4GB                              │          │
│  │             │ (Linux Mem)  │                                  │          │
│  │  0xFFFFFFFF └──────────────┘                                  │          │
│  └───────────────────────────────────────────────────────────────┘          │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────┐          │
│  │                 Peripheral Usage Summary                       │          │
│  ├───────────────────────────────────────────────────────────────┤          │
│  │  Peripheral    Status      Driver          DTS Node           │          │
│  │  ──────────────────────────────────────────────────────────   │          │
│  │  UART0         ✅ Enabled   serial-s32      /soc/serial@...   │          │
│  │  UART1         ✅ Enabled   serial-s32      /soc/serial@...   │          │
│  │  UART2         ❌ Disabled  -               -                  │          │
│  │  SPI0          ✅ Enabled   spi-s32         /soc/spi@...      │          │
│  │  I2C0          ✅ Enabled   i2c-s32         /soc/i2c@...      │          │
│  │  CAN0          ⚠️ No Driver flexcan         /soc/can@...      │          │
│  │  ETH0          ✅ Enabled   stmmac          /soc/ethernet@... │          │
│  └───────────────────────────────────────────────────────────────┘          │
│                                                                              │
│  [📊 전체 리소스 내보내기 (CSV)]  [📄 리포트 생성 (PDF)]                     │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 5.6 레시피/레이어 의존성 뷰어

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                   Recipe Dependency Graph                                    │
├──────────────────────────────────────────────────────────────────────────────┤
│  Target: custom-image                                                        │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                          custom-image                                        │
│                               │                                              │
│           ┌───────────────────┼───────────────────┐                          │
│           │                   │                   │                          │
│           ▼                   ▼                   ▼                          │
│    packagegroup-base    linux-s32          u-boot-s32                        │
│           │                   │                   │                          │
│     ┌─────┴─────┐       ┌─────┴─────┐       ┌─────┴─────┐                    │
│     │           │       │           │       │           │                    │
│     ▼           ▼       ▼           ▼       ▼           ▼                    │
│   busybox    systemd  gcc-cross  openssl  arm-tf     optee                   │
│                                                                              │
│  ───────────────────────────────────────────────────────────────────────     │
│  📊 의존성 통계                                                              │
│  ├─ 총 레시피 수: 287                                                        │
│  ├─ 빌드 시간 예상: ~45분                                                    │
│  ├─ 디스크 사용량: ~12GB                                                     │
│  └─ 레이어 분포:                                                             │
│      ├─ meta-local: 5개 (1.7%)                                               │
│      ├─ meta-alb: 89개 (31%)                                                 │
│      ├─ poky/meta: 156개 (54%)                                               │
│      └─ 기타: 37개 (13%)                                                     │
│                                                                              │
│  [🔍 특정 레시피 검색]  [📥 의존성 그래프 내보내기]  [🔄 새로고침]           │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 5.7 BSP 뷰어 기능 요구사항

| ID | 기능 | 우선순위 | 설명 |
|----|------|----------|------|
| VW-01 | GPIO/핀 검색 | P0 | 핀 이름/번호/기능으로 검색, 정의 위치 즉시 표시 |
| VW-02 | Device Tree 트리 뷰 | P0 | include chain 병합, 노드 계층 시각화 |
| VW-03 | DT 노드 오버라이드 추적 | P0 | 각 속성이 어느 파일에서 정의/오버라이드 되었는지 표시 |
| VW-04 | Include Chain 분석 | P0 | C/H 파일의 #include 체인 그래프 시각화 |
| VW-05 | 심볼 정의 점프 | P0 | 매크로/함수/변수 정의 위치로 원클릭 이동 |
| VW-06 | 메모리 맵 뷰어 | P1 | SoC 메모리 맵, 페리페럴 주소 시각화 |
| VW-07 | 페리페럴 상태 요약 | P1 | 각 HW 블록의 활성화/드라이버 상태 표시 |
| VW-08 | 레시피 의존성 그래프 | P1 | bitbake 의존성 트리 시각화 |
| VW-09 | 크로스 레퍼런스 | P1 | "이 심볼이 사용된 모든 위치" 검색 |
| VW-10 | DTS/DTB 비교 | P2 | 컴파일 전/후 Device Tree 비교 |

---

## 6. 통합 코드 에디터

### 6.1 에디터 개요

Eclipse 수준의 **통합 편집 환경**을 제공하여 외부 에디터 없이 모든 BSP 작업을 완결한다.

### 6.2 핵심 편집 기능

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                         Integrated Code Editor                               │
├──────────────────────────────────────────────────────────────────────────────┤
│  File: arch/arm64/boot/dts/freescale/custom-board.dts                       │
├──────────────────────────────────────────────────────────────────────────────┤
│  1  │ /dts-v1/;                                                              │
│  2  │                                                                        │
│  3  │ #include "s32g274a-evb.dts"     ◀── Ctrl+클릭: 파일로 이동            │
│  4  │                                                                        │
│  5  │ / {                                                                    │
│  6  │     model = "Custom Board Rev1";                                       │
│  7  │     compatible = "vendor,custom-board", "nxp,s32g274a";                │
│  8  │ };                                                                     │
│  9  │                                                                        │
│ 10  │ &uart2 {                        ◀── 호버: 원본 정의 미리보기           │
│ 11  │ ┌─────────────────────────────────────────────────────┐                │
│ 12  ││ 📍 uart2 원본 정의                                   │                │
│ 13  ││ 파일: s32g274a.dtsi:156                              │                │
│ 14  ││ ─────────────────────────────────────                │                │
│ 15  ││ uart2: serial@401c8000 {                             │                │
│ 16  ││     compatible = "nxp,s32-linflexuart";              │                │
│ 17  ││     reg = <0x401c8000 0x1000>;                       │                │
│ 18  ││     interrupts = <GIC_SPI 83 IRQ_TYPE_LEVEL_HIGH>;   │                │
│ 19  ││     status = "disabled";                             │                │
│ 20  ││ };                                                   │                │
│ 21  │└─────────────────────────────────────────────────────┘                │
│ 22  │     status = "okay";                                                   │
│ 23  │     pinctrl-names = "default";                                         │
│ 24  │     pinctrl-0 = <&pinctrl_uart2>;                                      │
│ 25  │ };                                                                     │
│ 26  │                                                                        │
│ 27  │ &pinctrl {                                                             │
│ 28  │     pinctrl_uart2: uart2grp {                                          │
│ 29  │         fsl,pins = <                                                   │
│ 30  │             S32_PINMUX(PE10, 1)    /* UART2_TX */                       │
│     │             ▲                                                          │
│     │             │ 💡 자동완성: S32_PINMUX(pin, func)                       │
│     │             └─ 정의: dt-bindings/pinctrl/s32-pinctrl.h:89              │
│ 31  │             S32_PINMUX(PE11, 1)    /* UART2_RX */                       │
│ 32  │         >;                                                             │
│ 33  │     };                                                                 │
│ 34  │ };                                                                     │
│                                                                              │
├──────────────────────────────────────────────────────────────────────────────┤
│  Problems: 0    Warnings: 1 (pinctrl_uart2 중복 정의 가능성)                 │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 6.3 지원 파일 형식 및 기능

| 파일 형식 | 구문 하이라이트 | 자동완성 | 정의 점프 | 실시간 검증 |
|-----------|----------------|----------|-----------|-------------|
| Device Tree (.dts/.dtsi) | ✅ | ✅ 노드/속성 | ✅ include/노드 | ✅ dtc 문법 |
| BitBake (.bb/.bbappend/.conf) | ✅ | ✅ 변수/함수 | ✅ include/require | ✅ 변수 검증 |
| Kconfig | ✅ | ✅ 심볼/타입 | ✅ depends/select | ✅ 의존성 |
| C/C++ Header | ✅ | ✅ 매크로 | ✅ #include chain | ⚠️ 기본만 |
| Kernel Config (.config) | ✅ | ✅ CONFIG_* | ✅ Kconfig 연결 | ✅ 유효성 |
| Shell Script | ✅ | ⚠️ 기본 | ⚠️ 기본 | ⚠️ shellcheck |

### 6.4 스마트 편집 기능

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                       Smart Editing Features                                 │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1️⃣ Go to Definition (Ctrl + 클릭 / F12)                                    │
│     ┌─────────────────────────────────────────────────────────────────────┐ │
│     │  #include "s32g274a.dtsi"                                           │ │
│     │            ▲                                                        │ │
│     │            └─ 클릭 → 해당 파일 열기                                 │ │
│     │                                                                     │ │
│     │  pinctrl-0 = <&pinctrl_uart2>;                                      │ │
│     │               ▲                                                     │ │
│     │               └─ 클릭 → pinctrl_uart2 정의 위치로 이동              │ │
│     └─────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  2️⃣ Peek Definition (Alt + F12)                                             │
│     └─ 이동 없이 팝업으로 정의 미리보기                                      │
│                                                                              │
│  3️⃣ Find All References (Shift + F12)                                       │
│     └─ 심볼이 사용된 모든 위치 목록                                          │
│                                                                              │
│  4️⃣ Auto-Complete (Ctrl + Space)                                            │
│     └─ 컨텍스트 인식 자동완성                                                │
│        ├─ DTS: 노드 이름, 속성 이름, phandle                                 │
│        ├─ BitBake: 변수, 함수, 클래스                                        │
│        └─ Kconfig: CONFIG_ 심볼, 타입                                        │
│                                                                              │
│  5️⃣ Quick Fix (Ctrl + .)                                                    │
│     └─ 문제 자동 수정 제안                                                   │
│        ├─ "status 속성 누락" → status = "okay"; 추가                         │
│        └─ "include 경로 오류" → 올바른 경로 제안                             │
│                                                                              │
│  6️⃣ Breadcrumb Navigation                                                   │
│     └─ 현재 위치: root > soc > pinctrl > pinctrl_uart2 > fsl,pins            │
│        ▲                                                                     │
│        └─ 각 단계 클릭으로 빠른 이동                                         │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 6.5 멀티 파일 편집 지원

```
┌──────────────────────────────────────────────────────────────────────────────┐
│  [custom-board.dts ×] [pinctrl.h ×] [linux-s32.bbappend ×]                  │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────┬────────────────────────────┐                │
│  │  custom-board.dts          │  s32-pinctrl.h             │                │
│  │  (Split View)              │  (Related File)            │                │
│  ├────────────────────────────┼────────────────────────────┤                │
│  │  &pinctrl {                │  #ifndef __S32_PINCTRL_H   │                │
│  │      pinctrl_uart2: ...{   │  #define __S32_PINCTRL_H   │                │
│  │          fsl,pins = <      │                            │                │
│  │   ┌──────────────────────┐ │  #define S32_PINMUX(a,b) \ │                │
│  │   │ S32_PINMUX(PE10, 1)  │◀┼──    ((a) << 8 | (b))     │                │
│  │   └──────────────────────┘ │                            │                │
│  │          >;                │  #define PE10  42          │                │
│  │      };                    │  #define PE11  43          │                │
│  │  };                        │                            │                │
│  │                            │  #endif                    │                │
│  └────────────────────────────┴────────────────────────────┘                │
│                                                                              │
│  💡 연관 파일 자동 감지: pinctrl.h가 현재 편집 파일에서 사용됨               │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 6.6 에디터 기능 요구사항

| ID | 기능 | 우선순위 | 설명 |
|----|------|----------|------|
| ED-01 | 구문 하이라이트 | P0 | DTS/BB/Kconfig/C/Shell 지원 |
| ED-02 | Go to Definition | P0 | include/심볼 정의로 원클릭 이동 |
| ED-03 | 자동완성 | P0 | 컨텍스트 인식, 파일 형식별 맞춤 |
| ED-04 | 실시간 검증 | P0 | 문법 오류 즉시 표시 |
| ED-05 | Peek Definition | P1 | 팝업으로 정의 미리보기 |
| ED-06 | Find All References | P1 | 심볼 사용 위치 전체 검색 |
| ED-07 | Split View | P1 | 연관 파일 나란히 편집 |
| ED-08 | Quick Fix | P2 | 자동 수정 제안 |
| ED-09 | Breadcrumb | P2 | 계층 구조 내비게이션 |
| ED-10 | Git 통합 | P2 | 변경 내역 표시, diff 뷰 |

---

## 7. 정책 시스템 (Policy Engine)

### 7.1 정책 개요

정책 시스템은 **사용자 행동을 제어·유도·차단**하여 "초보자 실수 방지 + 팀 표준 강제 + 재현성 확보"를 달성한다.

### 7.2 정책 파일 구조 (policy.yaml)

```yaml
# policy.yaml — 프로젝트 루트에 위치
bsp_policy_version: "1.0"
project_name: "s32g-bsp"
mode: strict   # strict | normal | expert

# ─────────────────────────────────────────────────────────────
# 1. 레이어 보호 정책
# ─────────────────────────────────────────────────────────────
layers:
  protected:
    - meta-alb          # NXP ALB 레이어
    - meta-nxp          # NXP 공식 레이어
    - meta-freescale    # Freescale 레거시
  custom_layer: meta-local   # 사용자 커스텀 레이어 (자동 생성 대상)

# ─────────────────────────────────────────────────────────────
# 2. 커널 정책
# ─────────────────────────────────────────────────────────────
kernel:
  provider:
    allow:
      - linux-s32       # 허용된 커널 provider 목록
  config_strategy:
    default: fragment   # fragment | defconfig | patch
    forbid:
      - direct_vendor_defconfig_edit    # 벤더 defconfig 직접 수정 금지
      - direct_vendor_recipe_edit       # 벤더 레시피 직접 수정 금지

# ─────────────────────────────────────────────────────────────
# 3. conf 파일 정책
# ─────────────────────────────────────────────────────────────
conf:
  local.conf:
    allow_keys:
      - IMAGE_FSTYPES
      - DISTRO_FEATURES
      - EXTRA_IMAGE_FEATURES
      - INHERIT
      - MACHINE_FEATURES
    deny_keys:
      - DL_DIR          # 서버 고정값, 변경 금지
      - SSTATE_DIR      # 서버 고정값, 변경 금지
  bblayers.conf:
    warn_on_manual_edit: true   # 수동 편집 시 경고

# ─────────────────────────────────────────────────────────────
# 4. 빌드 정책
# ─────────────────────────────────────────────────────────────
build:
  allow_targets:
    - core-image-minimal
    - custom-image
    - virtual/kernel
  forbid_tasks:
    - cleansstate       # 위험한 태스크 금지 (초보자 모드)
  require_manifest: true   # 빌드 시 manifest 필수 생성

# ─────────────────────────────────────────────────────────────
# 5. 초보자 모드 보호 장치
# ─────────────────────────────────────────────────────────────
beginner_mode:
  enabled: true
  forbid:
    - bitbake_shell           # bitbake -c devshell 금지
    - manual_tmp_edit         # tmp/ 직접 수정 금지
    - arbitrary_command       # 임의 명령 실행 금지
  require_confirmation:
    - build_clean             # clean 작업 전 확인
    - layer_priority_change   # 레이어 우선순위 변경 전 확인
```

### 7.3 정책 적용 수준

| 수준 | 동작 | UI 표현 |
|------|------|---------|
| **deny** | 작업 완전 차단 | 🚫 빨간색 + 대안 버튼 제공 |
| **warn** | 경고 표시 후 계속 가능 | ⚠️ 노란색 + 확인 다이얼로그 |
| **recommend** | 가이드만 표시 | 💡 파란색 + 추천 안내 |

### 7.4 정책 적용 예시

```
┌──────────────────────────────────────────────────────────────────────────┐
│                     정책 적용 시나리오 예시                               │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [시나리오 1] 벤더 레이어 직접 수정 시도                                 │
│  ─────────────────────────────────────────                               │
│  사용자 행동: meta-alb/recipes-kernel/linux/linux-s32.bb 수정 시도       │
│  정책 판정:   layers.protected에 meta-alb 포함 → DENY                    │
│  UI 반응:    🚫 "벤더 레이어는 직접 수정할 수 없습니다"                  │
│              [meta-local에 bbappend 생성] 버튼 제공                      │
│                                                                          │
│  [시나리오 2] local.conf에서 DL_DIR 변경 시도                            │
│  ─────────────────────────────────────────                               │
│  사용자 행동: local.conf에 DL_DIR = "/custom/path" 추가                  │
│  정책 판정:   conf.local.conf.deny_keys에 DL_DIR 포함 → DENY             │
│  UI 반응:    🚫 "DL_DIR은 서버 고정값입니다. 변경할 수 없습니다."        │
│                                                                          │
│  [시나리오 3] 허용되지 않은 빌드 타겟 시도                               │
│  ─────────────────────────────────────────                               │
│  사용자 행동: bitbake some-unknown-image 시도                            │
│  정책 판정:   build.allow_targets에 미포함 → WARN                        │
│  UI 반응:    ⚠️ "허용 목록에 없는 타겟입니다. 계속하시겠습니까?"         │
│              [계속] [취소] 버튼                                          │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

### 7.5 정책 모드 설명

| 모드 | 대상 사용자 | 특징 |
|------|-------------|------|
| **strict** | 초보자, 신규 팀원 | 모든 가드레일 활성화, 대부분 deny |
| **normal** | 중급자 | 위험한 작업만 warn, 나머지 허용 |
| **expert** | 숙련자 | 최소한의 제한, 대부분 recommend |

---

## 8. 빌드 Job 및 Manifest 시스템

### 8.1 Job 시스템 개요

모든 빌드 결과를 **완전 재현 가능**하게 만들기 위한 체계적인 Job 관리 시스템.

### 8.2 Job 디렉토리 구조

```
/artifacts/
└── <project>/
    └── <job-id>/
        ├── manifest.json          # 빌드 메타데이터 (핵심)
        ├── images/
        │   ├── *.wic.gz           # SD카드 이미지
        │   ├── *.img              # Raw 이미지
        │   ├── Image              # 커널 이미지
        │   └── *.dtb              # 디바이스 트리
        └── logs/
            ├── bitbake.log        # 전체 빌드 로그
            ├── cooker.log         # BitBake 내부 로그
            └── task-log/          # 개별 태스크 로그
```

### 8.3 Job ID 규칙

```
형식: <YYYYMMDD>-<HHMMSS>-<machine>-<image>
예시: 20260128-103012-s32g274a-custom-image

구성요소:
├── 20260128      → 날짜 (YYYYMMDD)
├── 103012        → 시간 (HHMMSS)
├── s32g274a      → MACHINE 변수값
└── custom-image  → 빌드 타겟 이미지명
```

### 8.4 manifest.json 스키마

```json
{
  "$schema": "bsp-studio/manifest/v1",
  
  "job_id": "20260128-103012-s32g274a-custom-image",
  "project": "s32g-bsp",
  "status": "success",
  
  "build_info": {
    "machine": "s32g274a",
    "image": "custom-image",
    "kernel_provider": "linux-s32",
    "distro": "fsl-auto",
    "timestamp": "2026-01-28T10:30:12+09:00",
    "duration_seconds": 1847,
    "build_command": "bitbake custom-image"
  },
  
  "source_info": {
    "git": {
      "commit": "abc1234567890def",
      "branch": "main",
      "remote": "origin",
      "dirty": false
    },
    "layers": [
      {
        "name": "meta-local",
        "path": "sources/meta-local",
        "priority": 10,
        "revision": "abc1234"
      }
    ]
  },
  
  "environment": {
    "DISTRO": "fsl-auto",
    "IMAGE_FSTYPES": "wic.gz ext4",
    "PREFERRED_PROVIDER_virtual/kernel": "linux-s32",
    "KERNEL_DEFCONFIG": "s32g274a_defconfig"
  },
  
  "artifacts": [
    {
      "file": "custom-image-s32g274a.wic.gz",
      "type": "sdcard_image",
      "size_bytes": 524288000,
      "sha256": "a1b2c3d4e5f6..."
    },
    {
      "file": "Image",
      "type": "kernel",
      "size_bytes": 12582912,
      "sha256": "f6e5d4c3b2a1..."
    }
  ],
  
  "config_changes": {
    "kernel_fragments": ["myfeature.cfg", "debug.cfg"],
    "local_conf_diff": "IMAGE_FSTYPES changed from 'wic' to 'wic.gz ext4'"
  },
  
  "error": null
}
```

### 8.5 실패 Job 처리

```json
{
  "job_id": "20260128-113045-s32g274a-custom-image",
  "status": "failed",
  
  "error": {
    "type": "build_error",
    "phase": "do_compile",
    "recipe": "linux-s32",
    "message": "arm-poky-linux-gnueabi-gcc: error: unrecognized option",
    "log_file": "logs/task-log/linux-s32/do_compile.log",
    "suggested_actions": [
      "Check KERNEL_DEFCONFIG compatibility",
      "Verify toolchain version"
    ]
  },
  
  "artifacts": []
}
```

### 8.6 Job 실행 흐름

```
┌──────────────────────────────────────────────────────────────────────────┐
│                           서버 Job 실행 흐름                             │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  1. Job ID 생성                                                          │
│     └─ 타임스탬프 + MACHINE + IMAGE 조합                                 │
│                                                                          │
│  2. Job 디렉토리 초기화                                                  │
│     └─ /artifacts/<project>/<job-id>/ 생성                               │
│                                                                          │
│  3. 환경 변수 스냅샷 저장                                                │
│     └─ bitbake -e <image> 실행, 주요 변수 추출                           │
│                                                                          │
│  4. BitBake 실행                                                         │
│     └─ bitbake <image> 2>&1 | tee bitbake.log                            │
│                                                                          │
│  5. 빌드 결과 수집                                                       │
│     ├─ tmp/deploy/images/<machine>/ 에서 파일 복사                       │
│     └─ 파일별 sha256 계산                                                │
│                                                                          │
│  6. manifest.json 생성                                                   │
│     └─ 위 모든 정보 JSON으로 직렬화                                      │
│                                                                          │
│  7. 완료 신호 전송                                                       │
│     └─ Electron 앱에 SFTP 다운로드 준비 알림                             │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

### 8.7 재현(Rebuild) 메커니즘

```
┌──────────────────────────────────────────────────────────────────────────┐
│                         "이 빌드 재현" 기능                               │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [입력] 이전 빌드의 manifest.json                                        │
│                                                                          │
│  [처리]                                                                  │
│  1. source_info.git.commit 체크아웃                                      │
│  2. environment 변수 복원                                                │
│  3. config_changes 적용                                                  │
│  4. build_info.build_command 실행                                        │
│                                                                          │
│  [출력] 동일한 아티팩트 (sha256 일치 검증)                               │
│                                                                          │
│  [UI]                                                                    │
│  ┌─────────────────────────────────────────┐                            │
│  │  Job: 20260128-103012-s32g274a-...      │                            │
│  │  Status: ✅ Success                     │                            │
│  │                                         │                            │
│  │  [📥 다운로드]  [🔄 이 빌드 재현]       │                            │
│  └─────────────────────────────────────────┘                            │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 9. 커널 설정 전략 (Kernel Configuration Strategy)

### 9.1 전략 개요

벤더 커널 환경(예: linux-s32)에서도 **안전하고 재현 가능한 커널 설정 변경**을 보장한다.

### 9.2 커널 Provider 자동 감지

```bash
# 서버에서 실행되는 감지 명령
bitbake -e virtual/kernel | grep -E "^(PN|FILE|PREFERRED_PROVIDER|SRC_URI|KERNEL_DEFCONFIG)="
```

**파싱 대상 변수:**

| 변수 | 용도 | 예시 |
|------|------|------|
| `PN` | 레시피 이름 | `linux-s32` |
| `FILE` | 레시피 파일 경로 | `/path/to/meta-alb/recipes-kernel/linux/linux-s32_5.10.bb` |
| `PREFERRED_PROVIDER_virtual/kernel` | 커널 provider 설정 | `linux-s32` |
| `SRC_URI` | 소스 위치 + 추가 파일 | `git://...;file://defconfig;file://feature.cfg` |
| `KERNEL_DEFCONFIG` | defconfig 파일명 | `s32g274a_defconfig` |

### 9.3 커널 설정 변경 전략

#### Strategy A — Config Fragment (✅ 권장)

```
┌──────────────────────────────────────────────────────────────────────────┐
│                     Strategy A: Config Fragment                          │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [원리]                                                                  │
│  - 벤더 defconfig를 그대로 유지                                          │
│  - .cfg 파일로 추가 설정만 오버라이드                                    │
│  - bbappend를 통해 SRC_URI에 fragment 추가                               │
│                                                                          │
│  [파일 구조]                                                             │
│  meta-local/                                                             │
│  └── recipes-kernel/                                                     │
│      └── linux/                                                          │
│          ├── linux-s32_%.bbappend                                        │
│          └── files/                                                      │
│              ├── enable-debug.cfg                                        │
│              └── custom-driver.cfg                                       │
│                                                                          │
│  [bbappend 내용]                                                         │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │ FILESEXTRAPATHS:prepend := "${THISDIR}/files:"             │         │
│  │ SRC_URI += "file://enable-debug.cfg"                       │         │
│  │ SRC_URI += "file://custom-driver.cfg"                      │         │
│  └────────────────────────────────────────────────────────────┘         │
│                                                                          │
│  [.cfg 파일 예시 - enable-debug.cfg]                                     │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │ CONFIG_DEBUG_INFO=y                                        │         │
│  │ CONFIG_DEBUG_FS=y                                          │         │
│  │ CONFIG_DYNAMIC_DEBUG=y                                     │         │
│  └────────────────────────────────────────────────────────────┘         │
│                                                                          │
│  [장점]                                                                  │
│  ✅ 벤더 업데이트에 안전                                                 │
│  ✅ 변경 추적 용이 (git diff)                                            │
│  ✅ 모듈화된 설정 관리                                                   │
│  ✅ 재현성 보장                                                          │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

#### Strategy B — Defconfig 직접 관리 (⚠️ 제한적)

```
┌──────────────────────────────────────────────────────────────────────────┐
│                   Strategy B: Defconfig 직접 관리                        │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [사용 조건]                                                             │
│  - 벤더 defconfig 완전 교체가 필요한 경우                                │
│  - 정책에서 명시적으로 허용한 경우                                       │
│                                                                          │
│  [경고 표시]                                                             │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │  ⚠️ 경고: Defconfig 직접 수정                              │         │
│  │                                                            │         │
│  │  벤더 defconfig를 직접 수정하면:                           │         │
│  │  • 벤더 업데이트 시 충돌 발생 가능                         │         │
│  │  • 변경 내역 추적이 어려움                                 │         │
│  │                                                            │         │
│  │  [Fragment 방식으로 전환]  [그래도 계속]                   │         │
│  └────────────────────────────────────────────────────────────┘         │
│                                                                          │
│  [허용 시 동작]                                                          │
│  - bbappend에서 KERNEL_DEFCONFIG 오버라이드                              │
│  - 변경된 defconfig를 files/에 복사                                      │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

#### Strategy C — Patch 기반 (🔧 소스 변경용)

```
┌──────────────────────────────────────────────────────────────────────────┐
│                      Strategy C: Patch 기반                              │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [사용 조건]                                                             │
│  - Kconfig 구조 자체 변경이 필요한 경우                                  │
│  - 커널 소스 코드 수정이 필요한 경우                                     │
│                                                                          │
│  [워크플로]                                                              │
│  1. 커널 소스 체크아웃                                                   │
│  2. 변경 작업 수행                                                       │
│  3. git format-patch 생성                                                │
│  4. meta-local/files/*.patch 저장                                        │
│  5. bbappend에 SRC_URI += "file://my-fix.patch" 추가                     │
│                                                                          │
│  [파일 구조]                                                             │
│  meta-local/                                                             │
│  └── recipes-kernel/                                                     │
│      └── linux/                                                          │
│          ├── linux-s32_%.bbappend                                        │
│          └── files/                                                      │
│              └── 0001-Fix-driver-issue.patch                             │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

### 9.4 자동 탐지 로직

```
┌──────────────────────────────────────────────────────────────────────────┐
│                      커널 설정 자동 탐지 알고리즘                         │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  function detectKernelConfigStrategy():                                  │
│      env = parseOutput(bitbake -e virtual/kernel)                        │
│                                                                          │
│      # 1. SRC_URI에서 기존 fragment 확인                                 │
│      fragments = findPattern(env.SRC_URI, "file://*.cfg")                │
│                                                                          │
│      # 2. KERNEL_DEFCONFIG 확인                                          │
│      hasDefconfig = env.KERNEL_DEFCONFIG != null                         │
│                                                                          │
│      # 3. 기존 bbappend 존재 여부                                        │
│      hasBbappend = fileExists("meta-local/**/linux-*%.bbappend")         │
│                                                                          │
│      # 4. 전략 결정                                                      │
│      if fragments.length > 0:                                            │
│          return Strategy.FRAGMENT  # 이미 fragment 사용 중              │
│      elif hasBbappend:                                                   │
│          return Strategy.FRAGMENT  # bbappend 있으면 fragment 권장      │
│      elif hasDefconfig:                                                  │
│          return Strategy.FRAGMENT  # defconfig 있어도 fragment 권장     │
│      else:                                                               │
│          return Strategy.FRAGMENT  # 기본값: fragment                   │
│                                                                          │
│      # ⚠️ Strategy.DEFCONFIG는 명시적 요청 시에만 반환                  │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

### 9.5 CONFIG 변경 반영 검증

```
┌──────────────────────────────────────────────────────────────────────────┐
│                    CONFIG 반영 검증 자동화                               │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [검증 명령 시퀀스]                                                      │
│                                                                          │
│  # 1. 커널 재컴파일 (fragment 적용)                                      │
│  bitbake virtual/kernel -c compile -f                                    │
│                                                                          │
│  # 2. 최종 .config에서 설정 확인                                         │
│  # WORKDIR 경로 동적 획득                                                │
│  WORKDIR=$(bitbake -e virtual/kernel | grep "^WORKDIR=" | cut -d'"' -f2) │
│                                                                          │
│  # 3. 설정 검증                                                          │
│  grep "CONFIG_DEBUG_INFO" $WORKDIR/build/.config                         │
│  # 예상 출력: CONFIG_DEBUG_INFO=y                                        │
│                                                                          │
│  [UI 표시]                                                               │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │  ✅ CONFIG_DEBUG_INFO=y     → 반영됨                       │         │
│  │  ✅ CONFIG_DEBUG_FS=y       → 반영됨                       │         │
│  │  ⚠️ CONFIG_CUSTOM_DRIVER=m → 값 변경됨 (요청: y)          │         │
│  │  ❌ CONFIG_INVALID=y        → 존재하지 않는 옵션          │         │
│  └────────────────────────────────────────────────────────────┘         │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

### 9.6 초보자 보호 장치

```
┌──────────────────────────────────────────────────────────────────────────┐
│                    커널 설정 초보자 보호 장치                             │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  1. CONFIG 검색 UI                                                       │
│     ┌────────────────────────────────────────────────────────────┐      │
│     │  🔍 커널 옵션 검색: [DEBUG_INFO        ] [검색]            │      │
│     │                                                            │      │
│     │  결과:                                                     │      │
│     │  ├─ CONFIG_DEBUG_INFO          "Compile with debug info"  │      │
│     │  ├─ CONFIG_DEBUG_INFO_DWARF5   "DWARF 5 format"           │      │
│     │  └─ CONFIG_DEBUG_INFO_BTF      "BTF type info"            │      │
│     └────────────────────────────────────────────────────────────┘      │
│                                                                          │
│  2. HELP 텍스트 표시                                                     │
│     - Kconfig에서 추출한 도움말 표시                                     │
│     - 의존성 정보 (depends on, select) 시각화                            │
│                                                                          │
│  3. 위험 옵션 경고                                                       │
│     - CONFIG_DEBUG_KERNEL: "디버그 빌드, 성능 저하 가능"                 │
│     - CONFIG_PREEMPT_NONE: "실시간성 저하"                               │
│     - CONFIG_MODULES=n: "모든 드라이버 빌트인, 이미지 크기 증가"         │
│                                                                          │
│  4. 자동 의존성 해결                                                     │
│     - CONFIG_A 활성화 시 필요한 CONFIG_B 자동 추가 제안                  │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 10. 기능 요구사항 (Functional Requirements)

### 10.1 연결/인증 (FR-SSH)

| ID | 요구사항 | 우선순위 | 상세 |
|----|----------|----------|------|
| FR-SSH-01 | SSH 키 기반 연결 | P0 | Ed25519/RSA 지원 |
| FR-SSH-02 | 연결 테스트 | P0 | 권한, 디스크 여유, 필수 커맨드(bitbake, rsync) 확인 |
| FR-SSH-03 | 프로필 저장 | P0 | 프로젝트별 서버 프로필, OS Keychain 사용 |
| FR-SSH-04 | 연결 복구 | P1 | 네트워크 끊김 시 자동 재연결 시도 |

### 10.2 프로젝트 인식/인덱싱 (FR-PRJ)

| ID | 요구사항 | 우선순위 | 상세 |
|----|----------|----------|------|
| FR-PRJ-01 | 자동 탐색 | P0 | bblayers.conf, local.conf, layer.conf 파싱 |
| FR-PRJ-02 | 레이어 목록 | P0 | 우선순위(BBFILE_PRIORITY) 포함 |
| FR-PRJ-03 | 레시피 인덱스 | P1 | bitbake-layers show-recipes 결과 캐싱 |
| FR-PRJ-04 | 변수 인덱싱 | P1 | MACHINE, DISTRO, IMAGE_FSTYPES, PREFERRED_PROVIDER_virtual/kernel |
| FR-PRJ-05 | policy.yaml 로딩 | P0 | 프로젝트 루트에서 자동 로딩 |

### 10.3 편집 (FR-EDIT)

| ID | 요구사항 | 우선순위 | 상세 |
|----|----------|----------|------|
| FR-EDIT-01 | conf 편집 | P0 | 구문 하이라이트, 자동 완성, 검증 |
| FR-EDIT-02 | 레시피 편집 | P1 | .bb/.bbappend/.inc 지원 |
| FR-EDIT-03 | 패치 관리 | P2 | 추가/삭제/적용 대상 표시 |
| FR-EDIT-04 | 정책 검증 | P0 | 편집 시 실시간 policy.yaml 적용 |

### 10.4 커널 설정 (FR-KRN)

| ID | 요구사항 | 우선순위 | 상세 |
|----|----------|----------|------|
| FR-KRN-01 | Provider 감지 | P0 | bitbake -e virtual/kernel 파싱 |
| FR-KRN-02 | 벤더 커널 경고 | P0 | protected 레이어 레시피 수정 시 차단 |
| FR-KRN-03 | defconfig/fragment 탐지 | P0 | SRC_URI, KERNEL_DEFCONFIG 분석 |
| FR-KRN-04 | Fragment 자동 생성 | P0 | .cfg 파일 + bbappend 템플릿 제공 |
| FR-KRN-05 | 반영 검증 | P1 | 최종 .config와 요청 CONFIG 비교 |

### 10.5 동기화 (FR-SYNC)

| ID | 요구사항 | 우선순위 | 상세 |
|----|----------|----------|------|
| FR-SYNC-01 | rsync 증분 동기화 | P0 | 변경분만 전송 |
| FR-SYNC-02 | exclude 규칙 | P0 | tmp/, downloads/, sstate-cache/, build/ 제외 |
| FR-SYNC-03 | 동기화 리포트 | P1 | 전송 파일 목록, 충돌, 실패 원인 |
| FR-SYNC-04 | Windows 지원 | P0 | cwRsync 또는 WSL rsync 자동 선택 |

### 10.6 원격 빌드 (FR-BLD)

| ID | 요구사항 | 우선순위 | 상세 |
|----|----------|----------|------|
| FR-BLD-01 | 타겟 선택 | P0 | allow_targets 기반 드롭다운 |
| FR-BLD-02 | 로그 스트리밍 | P0 | 실시간 stdout/stderr 표시 |
| FR-BLD-03 | 빌드 옵션 | P1 | clean, cleansstate, -c compile, -c deploy |
| FR-BLD-04 | 실패 분석 | P1 | 로그 패턴 매칭으로 원인 후보 추출 |
| FR-BLD-05 | Job 생성 | P0 | 빌드 시작 시 job-id 자동 생성 |

### 10.7 아티팩트 (FR-ART)

| ID | 요구사항 | 우선순위 | 상세 |
|----|----------|----------|------|
| FR-ART-01 | 자동 탐지 | P0 | tmp/deploy/images/<machine>/ 스캔 |
| FR-ART-02 | manifest 생성 | P0 | manifest.json 스키마 준수 |
| FR-ART-03 | 로컬 다운로드 | P0 | SFTP 전송, sha256 검증 |
| FR-ART-04 | 히스토리 | P1 | 다운로드 기록, 즐겨찾기 |
| FR-ART-05 | 재현 버튼 | P1 | manifest 기반 동일 빌드 재실행 |

### 10.8 지식 내장 (FR-GUIDE)

| ID | 요구사항 | 우선순위 | 상세 |
|----|----------|----------|------|
| FR-GUIDE-01 | 단계별 가이드 | P0 | "다음에 뭘 해야 하는지" 컨텍스트 안내 |
| FR-GUIDE-02 | 용어 사전 | P1 | Layer, Recipe, Provider 등 툴팁 |
| FR-GUIDE-03 | 대안 제시 | P0 | deny 시 자동 대안 생성 버튼 |
| FR-GUIDE-04 | 추천 규칙 | P1 | policy.yaml recommend 항목 표시 |

### 10.9 히스토리/감사 (FR-HIST)

| ID | 요구사항 | 우선순위 | 상세 |
|----|----------|----------|------|
| FR-HIST-01 | 빌드 기록 | P0 | manifest.json 영구 보관 |
| FR-HIST-02 | 변경 추적 | P1 | 파일 diff, git commit 연결 |
| FR-HIST-03 | 재현 버튼 | P1 | "이 빌드 재현" 원클릭 |
| FR-HIST-04 | 검색/필터 | P2 | MACHINE, IMAGE, 날짜 기반 검색 |

---

## 11. 비기능 요구사항 (Non-Functional Requirements)

### 11.1 안정성

| ID | 요구사항 | 목표 수치 |
|----|----------|-----------|
| NFR-01 | 빌드 중 앱 종료 후 복구 | Job 상태 100% 복구 가능 |
| NFR-02 | 네트워크 끊김 후 재연결 | 30초 내 자동 재연결 시도 |
| NFR-03 | 실패 내역 안내 | "다음 행동" 제안 100% |

### 11.2 보안

| ID | 요구사항 | 구현 방법 |
|----|----------|-----------|
| NFR-SEC-01 | SSH 키 보안 저장 | Windows: Credential Manager, macOS: Keychain, Linux: libsecret |
| NFR-SEC-02 | 명령 실행 제한 | 화이트리스트 기반 + beginner_mode.forbid 적용 |
| NFR-SEC-03 | 경로 검증 | Path traversal 방지, 서버 경로 sanitization |

### 11.3 성능

| ID | 요구사항 | 목표 수치 |
|----|----------|-----------|
| NFR-PERF-01 | 인덱싱 속도 | 1000개 레시피 < 10초 |
| NFR-PERF-02 | 로그 스트리밍 | UI 멈춤 없이 10MB/s 처리 |
| NFR-PERF-03 | 파일 동기화 | 100MB 변경분 < 30초 (LAN 환경) |

### 11.4 이식성

| ID | 요구사항 | 지원 버전 |
|----|----------|-----------|
| NFR-PORT-01 | Windows | 10/11 (x64) |
| NFR-PORT-02 | Linux | Ubuntu 20.04+ (x64) |
| NFR-PORT-03 | macOS | 11.0+ (Intel/Apple Silicon) |
| NFR-PORT-04 | 서버 환경 | Ubuntu 18.04+, RHEL 8+, Debian 10+ |

---

## 12. UI/UX 요구사항

### 12.1 전체 레이아웃 (Eclipse 스타일)

```
┌────────────────────────────────────────────────────────────────────────────┐
│  File  Edit  View  Build  Tools  Help                          [─][□][×] │
├────────────────────────────────────────────────────────────────────────────┤
│  [📁 s32g-bsp] ▼  │  🔄 Sync  │  🔨 Build  │  📥 Download  │  ⚙️ Settings │
├──────────┬─────────────────────────────────────────────┬───────────────────┤
│          │                                             │                   │
│ Project  │              Editor / View                  │    Inspector      │
│ Explorer │                                             │                   │
│          │  ┌─────────────────────────────────────┐   │  Selected:        │
│ ▼ Layers │  │  local.conf                        ×│   │  local.conf       │
│   meta-  │  ├─────────────────────────────────────┤   │                   │
│   local  │  │  MACHINE = "s32g274a"               │   │  Type: Conf       │
│   meta-  │  │  DISTRO = "fsl-auto"                │   │  Layer: build     │
│   alb    │  │  IMAGE_FSTYPES = "wic.gz"           │   │                   │
│          │  │                                     │   │  Variables:       │
│ ▼ Recipes│  │  # Policy: allow_keys               │   │  • MACHINE ✅     │
│   linux- │  │  EXTRA_IMAGE_FEATURES = "debug"     │   │  • DISTRO ✅      │
│   s32    │  │                                     │   │                   │
│          │  └─────────────────────────────────────┘   │  Warnings: 0      │
│ ▼ Kernel │                                             │  Errors: 0        │
│   Config │                                             │                   │
│          │                                             │                   │
│ ▼ Conf   │                                             │                   │
│          │                                             │                   │
├──────────┴─────────────────────────────────────────────┴───────────────────┤
│  Console │ Problems │ Build Log │ Artifacts │ History                      │
├────────────────────────────────────────────────────────────────────────────┤
│  [10:30:15] Starting build: bitbake custom-image                           │
│  [10:30:16] Parsing recipes: 100% |████████████████████| 1523/1523         │
│  [10:30:45] Running task: linux-s32:do_compile                             │
│  [10:35:22] ✅ Build completed successfully                                │
│  [10:35:23] Artifacts ready for download                                   │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘
```

### 12.2 필수 패널

| 패널 | 내용 | 우선순위 |
|------|------|----------|
| **Dashboard** | 프로젝트 상태, 커널 provider, MACHINE, 최근 빌드 | P0 |
| **Project Explorer** | Layers/Recipes/Kernel/Conf/Patches 트리 | P0 |
| **⭐ Editor** | 통합 편집기 (Go to Definition, 자동완성) | P0 |
| **⭐ Device Tree Viewer** | DT 트리 구조, 노드 오버라이드 추적 | P0 |
| **⭐ GPIO/Pin Viewer** | 핀 검색, 정의 위치, GPIO Bank 시각화 | P0 |
| **⭐ Include Chain** | C/H 파일 include 그래프 | P1 |
| **⭐ HW Resource Map** | 메모리 맵, 페리페럴 상태 | P1 |
| **Inspector** | 선택 항목 메타 정보, 오버라이드 출처 | P1 |
| **Console** | 실시간 로그 출력 | P0 |
| **Problems** | 진단 결과, 경고, 해결 버튼 | P0 |
| **Build Log** | 빌드 상세 로그 | P0 |
| **Artifacts** | 다운로드 가능한 결과물 목록 | P0 |
| **Recipe Graph** | 레시피 의존성 그래프 | P2 |
| **History** | Job 히스토리, manifest 검색 | P1 |

### 12.3 정책 위반 UI 예시

```
┌────────────────────────────────────────────────────────────────────────────┐
│  🚫 Policy Violation                                                       │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  벤더 레이어 파일을 직접 수정할 수 없습니다.                               │
│                                                                            │
│  ┌──────────────────────────────────────────────────────────────────────┐ │
│  │  시도한 작업:                                                        │ │
│  │  meta-alb/recipes-kernel/linux/linux-s32_5.10.bb 수정                │ │
│  │                                                                      │ │
│  │  정책 위반:                                                          │ │
│  │  layers.protected에 "meta-alb" 포함                                  │ │
│  │                                                                      │ │
│  │  권장 대안:                                                          │ │
│  │  meta-local에 bbappend 파일을 생성하여 오버라이드                    │ │
│  └──────────────────────────────────────────────────────────────────────┘ │
│                                                                            │
│  [📝 meta-local/linux-s32_%.bbappend 자동 생성]         [취소]            │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘
```

---

## 13. 가드레일 시스템 (Guardrails)

### 13.1 가드레일 목록

| ID | 트리거 조건 | 동작 | 대안 제공 |
|----|-------------|------|-----------|
| GR-01 | protected 레이어 파일 수정 | DENY | bbappend 자동 생성 버튼 |
| GR-02 | deny_keys 변수 수정 | DENY | 변경 불가 안내 |
| GR-03 | 벤더 defconfig 직접 수정 | DENY | fragment 생성 버튼 |
| GR-04 | 허용되지 않은 빌드 타겟 | WARN | 계속/취소 선택 |
| GR-05 | MACHINE 변경 | WARN | deploy 경로 변화 안내 |
| GR-06 | cleansstate 실행 | WARN | 확인 다이얼로그 |
| GR-07 | 빌드 실패 | INFO | 원인 후보 TOP 3 + 해결 버튼 |
| GR-08 | 초보자 모드 금지 명령 | DENY | 설명 + 대안 안내 |

### 13.2 빌드 실패 분석 패턴

```yaml
# 빌드 실패 패턴 매칭 규칙 (내장)
failure_patterns:
  - pattern: "do_fetch: Fetcher failure.*Unable to find"
    cause: "다운로드 실패 - 네트워크 또는 URL 문제"
    actions:
      - "네트워크 연결 확인"
      - "DL_DIR 권한 확인"
      - "SRC_URI URL 유효성 확인"
  
  - pattern: "No recipes available for"
    cause: "레시피를 찾을 수 없음"
    actions:
      - "bblayers.conf에 해당 레이어 추가"
      - "레시피 이름 철자 확인"
  
  - pattern: "Nothing PROVIDES"
    cause: "의존성 미충족"
    actions:
      - "DEPENDS 변수 확인"
      - "필요한 레이어 추가"
  
  - pattern: "PREFERRED_PROVIDER.*multiple providers"
    cause: "provider 충돌"
    actions:
      - "PREFERRED_PROVIDER 명시적 설정"
      - "중복 레시피 확인"
  
  - pattern: "arm-.*-gcc: error:"
    cause: "컴파일 에러"
    actions:
      - "소스 코드 패치 확인"
      - "컴파일러 버전 호환성 확인"
```

---

## 14. 구현 로드맵

### 14.1 Phase 개요

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                              구현 로드맵 (v3.0)                               │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  Phase 0 (MVP)       Phase 1             Phase 2            Phase 3          │
│  ─────────────       ───────             ───────            ───────          │
│  4개월               3개월               2개월              2개월            │
│                                                                               │
│  ⭐ 핵심 뷰어        ⭐ 고급 뷰어        커널 자동화        팀/재현성        │
│  • Device Tree       • GPIO 핀 뷰어      • vendor kernel   • policy CI      │
│    트리 뷰어         • Include Chain       감지             • 빌드 이력     │
│  • 통합 에디터         그래프            • bbappend/       • 재현 버튼      │
│  • Go to Def         • 메모리 맵           fragment        • Git 연동       │
│  • 자동완성          • HW 리소스 맵        자동 생성                        │
│                      • 레시피 의존성     • CONFIG 검증                      │
│    인덱스                                                                 │
│  • conf 편집         • 변수 검색                                          │
│  • 원격 빌드           (최종값/출처)                                      │
│  • 로그 스트리밍     • 초보자 모드                                        │
│  • 아티팩트            (진단/해결)                                        │
│    다운로드                                                               │
│  • manifest 기록                                                          │
│  • 기본 policy                                                            │
│                                                                           │
│  ─────────────────────────────────────────────────────────────────────    │
│  |        |        |        |        |        |        |        |   →    │
│  M1       M2       M3       M4       M5       M6       M7       M8       │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
```

### 14.2 Phase 0 상세 (MVP) - 4개월

| 주차 | 작업 | 산출물 |
|------|------|--------|
| W1-2 | Electron 앱 기본 구조 | 프로젝트 스캐폴딩, IPC 설계 |
| W3-4 | SSH 연결 모듈 | ssh2 기반 연결/명령 실행 |
| W5-6 | **⭐ 통합 에디터 기본** | Monaco Editor 통합, 구문 하이라이트 |
| W7-8 | **⭐ Device Tree 파서** | DTS/DTSI 파싱, 트리 구조 시각화 |
| W9-10 | **⭐ Go to Definition** | include/심볼 정의 점프 구현 |
| W11-12 | rsync 동기화 모듈 | 증분 동기화, exclude 규칙 |
| W13-14 | 빌드 트리거/로그 스트리밍 | bitbake 실행, 실시간 로그 |
| W15-16 | 아티팩트 수집/다운로드 | SFTP 전송, sha256 검증 |
| W17 | manifest.json 생성 | Job 시스템, 스키마 구현 |
| W18 | 기본 Policy Engine | YAML 파싱, deny/warn 적용 |

### 14.3 Phase 1 상세 (고급 뷰어) - 3개월

| 주차 | 작업 | 산출물 |
|------|------|--------|
| W1-2 | **⭐ GPIO/핀 정보 파서** | pinctrl 노드 파싱, 핀 검색 |
| W3-4 | **⭐ Include Chain 분석기** | C/H 파일 #include 그래프 |
| W5-6 | **⭐ 메모리 맵 뷰어** | SoC 메모리 맵 시각화 |
| W7-8 | **⭐ HW 리소스 맵** | 페리페럴 상태/드라이버 매핑 |
| W9-10 | 레시피 의존성 그래프 | bitbake 의존성 시각화 |
| W11-12 | 변수 검색 (최종값/출처) | bitbake -e 파싱, 캐싱 |

### 14.4 마일스톤 정의

| 마일스톤 | 완료 조건 | 목표 일정 |
|----------|-----------|-----------|
| **M1: Basic Editor** | Device Tree 편집 + Go to Definition 동작 | Month 2 |
| **M2: First Build** | 초보자가 30분 내 첫 빌드 성공 | Month 4 |
| **M3: Advanced Viewer** | GPIO/Include Chain 뷰어 완성 | Month 6 |
| **M4: Policy Enforcement** | 벤더 레이어 보호 100% 동작 | Month 7 |
| **M5: Kernel Automation** | fragment 자동 생성 + 검증 | Month 9 |
| **M6: Full Reproducibility** | manifest 기반 재현 100% | Month 11 |

---

## 15. 리스크 분석 및 완화 전략

### 15.1 기술 리스크

| ID | 리스크 | 영향도 | 발생 확률 | 완화 전략 |
|----|--------|--------|-----------|-----------|
| R-01 | Yocto 변수 오버라이드 추적 복잡 | 높음 | 높음 | bitbake -e 파싱 표준화, 캐싱 |
| R-02 | 벤더 커널마다 defconfig 방식 다름 | 높음 | 중간 | 자동 탐지 + 수동 규칙 등록 UI |
| R-03 | Windows rsync/ssh 환경 이슈 | 중간 | 높음 | cwRsync 번들링, WSL 폴백 |
| R-04 | 프로젝트마다 정책 다름 | 중간 | 높음 | policy.yaml 외부화, 템플릿 제공 |
| R-05 | 대용량 로그 스트리밍 UI 멈춤 | 중간 | 중간 | 백프레셔, 가상 스크롤링 |
| R-06 | 서버 빌드 환경 다양성 | 중간 | 중간 | 최소 요구사항 문서화, 진단 도구 |

### 15.2 비즈니스 리스크

| ID | 리스크 | 완화 전략 |
|----|--------|-----------|
| BR-01 | 사용자 학습 곡선 | 단계별 가이드, 튜토리얼 비디오 |
| BR-02 | 기존 워크플로 저항 | 점진적 도입, 기존 도구 병행 지원 |
| BR-03 | 유지보수 부담 | 모듈화 설계, 플러그인 아키텍처 |

---

## 16. 수용 기준 (Acceptance Criteria)

### 16.1 핵심 수용 기준

| ID | 기준 | 검증 방법 |
|----|------|-----------|
| AC-01 | local.conf에서 IMAGE_FSTYPES 변경 후 빌드하면 새 이미지가 Artifacts 탭에 표시 | E2E 테스트 |
| AC-02 | linux-s32 커널 설정 변경 시 bbappend + fragment 방식 자동 제안 | 시나리오 테스트 |
| AC-03 | 빌드 실패 시 Problems 탭에 원인 후보 1개 이상 + 다음 행동 표시 | 실패 케이스 테스트 |
| AC-04 | 빌드 완료 시 manifest.json에 MACHINE/IMAGE/sha256/명령/시간 기록 | 스키마 검증 |
| AC-05 | protected 레이어 파일 수정 시 DENY + 대안 버튼 표시 | Policy 테스트 |
| AC-06 | manifest.json만으로 동일 빌드 재현 가능 | 재현성 테스트 |

### 16.2 ⭐ BSP 뷰어 수용 기준

| ID | 기준 | 검증 방법 |
|----|------|-----------|
| AC-VW-01 | GPIO 핀 이름 검색 시 3초 내 정의 위치 + include chain 표시 | 검색 테스트 |
| AC-VW-02 | Device Tree 노드 클릭 시 원본 정의 + 오버라이드 파일 목록 표시 | UI 테스트 |
| AC-VW-03 | #include 체인이 5단계 이상인 파일에서 심볼 정의 점프 동작 | 복잡도 테스트 |
| AC-VW-04 | DTS 파일에서 pinctrl 노드의 실제 핀 정보 시각화 | 파싱 테스트 |
| AC-VW-05 | 에디터에서 Ctrl+클릭으로 include 파일 즉시 이동 | UX 테스트 |
| AC-VW-06 | 메모리 맵 뷰어에서 페리페럴 주소 클릭 시 DTS 노드로 이동 | 연동 테스트 |

### 16.3 성능 수용 기준

| ID | 기준 | 목표 |
|----|------|------|
| AC-PERF-01 | 초보자 첫 빌드 성공 | ≤ 30분 |
| AC-PERF-02 | 설정 변경 → 빌드 → 다운로드 | ≤ 5 클릭 |
| AC-PERF-03 | 프로젝트 인덱싱 (1000 레시피) | ≤ 10초 |
| AC-PERF-04 | 로그 스트리밍 (10MB/s) | UI 응답 유지 |
| AC-PERF-05 | ⭐ Device Tree 파싱 (50개 DTSI 포함) | ≤ 5초 |
| AC-PERF-06 | ⭐ GPIO 핀 검색 응답 | ≤ 500ms |
| AC-PERF-07 | ⭐ Include Chain 분석 (10단계) | ≤ 2초 |

---

## 17. 용어집 (Glossary)

### 17.1 Yocto/BitBake 용어

| 용어 | 정의 |
|------|------|
| **Layer** | Yocto 메타데이터(레시피, 설정)의 논리적 그룹. meta-* 디렉토리 |
| **Recipe (.bb)** | 소프트웨어 빌드 방법을 정의한 파일 |
| **Append (.bbappend)** | 기존 레시피를 수정/확장하는 오버레이 파일 |
| **Conf** | 빌드 설정 파일 (local.conf, bblayers.conf) |
| **MACHINE** | 타겟 하드웨어 식별자 (예: s32g274a) |
| **DISTRO** | 배포판 정책 (예: fsl-auto, poky) |
| **Provider** | 가상 타겟을 실제로 제공하는 레시피 (예: virtual/kernel → linux-s32) |
| **SSTATE** | Shared State Cache. 빌드 중간 결과물 캐시 |
| **DL_DIR** | 다운로드 캐시 디렉토리 |
| **WORKDIR** | 레시피 빌드 작업 디렉토리 |
| **deploy/images** | 최종 빌드 결과물 저장 위치 |
| **Fragment (.cfg)** | 커널 설정 조각 파일 |
| **defconfig** | 커널 기본 설정 파일 |
| **bitbake** | Yocto 빌드 시스템의 태스크 실행 엔진 |
| **Job** | 단일 빌드 실행 단위 (job-id로 식별) |
| **Manifest** | 빌드 메타데이터를 기록한 JSON 파일 |

### 17.2 Device Tree 용어

| 용어 | 정의 |
|------|------|
| **DTS (Device Tree Source)** | 하드웨어 구조를 기술하는 텍스트 파일 |
| **DTSI (DT Include)** | 여러 DTS에서 공유하는 include 파일 |
| **DTB (Device Tree Blob)** | 컴파일된 바이너리 Device Tree |
| **노드 (Node)** | Device Tree의 기본 단위, 하드웨어 컴포넌트 표현 |
| **phandle** | 다른 노드를 참조하는 핸들 (예: <&pinctrl_uart2>) |
| **compatible** | 드라이버 매칭에 사용되는 속성 |
| **reg** | 메모리 매핑된 레지스터 주소 |

### 17.3 GPIO/핀 관련 용어

| 용어 | 정의 |
|------|------|
| **GPIO (General Purpose I/O)** | 범용 입출력 핀 |
| **pinctrl** | Pin Controller, 핀 멀티플렉싱 제어 |
| **Pin Mux** | 핀 기능 선택 (GPIO/UART/SPI 등) |
| **Pull-up/down** | 핀의 기본 전압 레벨 설정 |
| **Drive Strength** | 핀 출력 전류 세기 |
| **GPIO Bank** | GPIO 핀의 논리적 그룹 (예: GPIOA, GPIOB) |

### 17.4 뷰어/에디터 용어

| 용어 | 정의 |
|------|------|
| **Go to Definition** | 심볼 정의 위치로 이동하는 기능 |
| **Include Chain** | #include 지시자로 연결된 파일 계층 |
| **Peek Definition** | 현재 위치에서 정의 미리보기 |
| **Find All References** | 심볼이 사용된 모든 위치 검색 |
| **Breadcrumb** | 현재 코드 위치의 계층 구조 표시 |

---

## 부록 A: 프로젝트 전제 조건

### A.1 현재 확인된 사실

| 항목 | 값 |
|------|-----|
| BSP 유형 | Yocto 기반 |
| 서버 역할 | 빌드 전용 (로컬 편집 → 서버 빌드) |
| 커널 Provider | linux-s32 (벤더 커널) |
| 커널 레시피 경로 | meta-alb/recipes-kernel/linux/linux-s32_5.10.bb |
| 보호 레이어 | meta-alb, meta-nxp |

### A.2 서버 최소 요구사항

| 항목 | 요구사항 |
|------|----------|
| OS | Ubuntu 18.04+ / RHEL 8+ / Debian 10+ |
| 디스크 | 최소 100GB 여유 공간 |
| RAM | 16GB 이상 권장 |
| 필수 패키지 | git, tar, python3, gcc, make, rsync, bitbake |
| SSH | OpenSSH Server, 키 기반 인증 |

---

## 부록 B: policy.yaml 템플릿

```yaml
# policy.yaml 전체 템플릿 (프로젝트에 맞게 수정)
bsp_policy_version: "1.0"
project_name: "my-bsp-project"
mode: strict  # strict | normal | expert

layers:
  protected:
    - meta-vendor-1
    - meta-vendor-2
  custom_layer: meta-local

kernel:
  provider:
    allow:
      - linux-vendor
  config_strategy:
    default: fragment
    forbid:
      - direct_vendor_defconfig_edit
      - direct_vendor_recipe_edit

conf:
  local.conf:
    allow_keys:
      - IMAGE_FSTYPES
      - DISTRO_FEATURES
      - EXTRA_IMAGE_FEATURES
      - INHERIT
      - MACHINE_FEATURES
    deny_keys:
      - DL_DIR
      - SSTATE_DIR
  bblayers.conf:
    warn_on_manual_edit: true

build:
  allow_targets:
    - core-image-minimal
    - custom-image
  forbid_tasks: []
  require_manifest: true

beginner_mode:
  enabled: true
  forbid:
    - bitbake_shell
    - manual_tmp_edit
    - arbitrary_command
  require_confirmation:
    - build_clean
    - layer_priority_change
```

---

## 부록 C: manifest.json 스키마 (JSON Schema)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "BSP Studio Build Manifest",
  "type": "object",
  "required": ["job_id", "project", "status", "build_info", "artifacts"],
  "properties": {
    "job_id": {
      "type": "string",
      "pattern": "^\\d{8}-\\d{6}-.+-.+$"
    },
    "project": { "type": "string" },
    "status": { "enum": ["success", "failed", "cancelled"] },
    "build_info": {
      "type": "object",
      "required": ["machine", "image", "timestamp", "build_command"],
      "properties": {
        "machine": { "type": "string" },
        "image": { "type": "string" },
        "kernel_provider": { "type": "string" },
        "distro": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "duration_seconds": { "type": "integer" },
        "build_command": { "type": "string" }
      }
    },
    "source_info": {
      "type": "object",
      "properties": {
        "git": {
          "type": "object",
          "properties": {
            "commit": { "type": "string" },
            "branch": { "type": "string" },
            "dirty": { "type": "boolean" }
          }
        }
      }
    },
    "environment": { "type": "object" },
    "artifacts": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["file", "sha256"],
        "properties": {
          "file": { "type": "string" },
          "type": { "type": "string" },
          "size_bytes": { "type": "integer" },
          "sha256": { "type": "string" }
        }
      }
    },
    "error": {
      "type": ["object", "null"],
      "properties": {
        "type": { "type": "string" },
        "phase": { "type": "string" },
        "message": { "type": "string" },
        "suggested_actions": { "type": "array", "items": { "type": "string" } }
      }
    }
  }
}
```

---

> **문서 종료**  
> 본 문서는 Yocto BSP Studio의 완전한 요구사항 명세서로서,  
> 구현 팀이 참조해야 할 모든 기술적·비즈니스적 요구사항을 포함한다.
